#
# ~/.aliases
#

## rbenv
rbenv_exists=`which rbenv` > /dev/null 2>&1
if [ -e $rbenv_exists ]; then
    eval "$(rbenv init -)"
    alias be='bundle exec'
    alias development='export RAILS_ENV=development'
    alias test='export RAILS_ENV=test'
    alias qa='export RAILS_ENV=qa'
fi

## mutt
alias gmail='mutt -F ~/.mutt/account.gmail'
alias hireology='mutt -F ~/.mutt/account.hireology'
alias wits='mutt -F ~/.mutt/account.witsmd'
alias opmbx='mutt -F ~/.mutt/account.opmbx'
alias agmail='mutt -F ~/.mutt/account.gmail.old'
alias aopmbx='mutt -F ~/.mutt/account.opmbx.old'

## General stuff
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias norsk='setxkbmap no'
alias eng='setxkbmap us'
alias 3cal='cal -3'
alias isomount='sudo mount -o loop,exec'
alias ll='ls -lh'
alias la='ls -A'
alias lah='ls -lah'
alias usg='du -h --max-depth=1 -x'
alias z='. ~/.zshrc'
alias b='. ~/.bashrc'
alias c='clear'
alias hc='cd && clear'
alias nocomment='grep -Ev '\''^(#|$)'\'''
alias sudo='sudo -E '
alias term='urxvt -g 100x50'
alias matrix='cmatrix -b -u 10'
alias pp='~/bin/privatepaste.py -s daemoniz'
alias pa='~/bin/privatepaste.py -s abowles'
alias ta='tmux attach'
alias pb='time packer build'

## workspaces
alias env-wits='. ~/.ENV_WITS'
alias env-hlgy='. ~/.ENV_HLGY'

## vim
alias e='vim -p '
alias se='sudo -e '

## Apt
alias acs="apt-cache search"
alias acp="apt-cache policy"
alias acsh="apt-cache show"
alias agi="apt-get install"
alias aga="apt-get autoremove"
alias update='sudo apt-get update'
alias upgrade='sudo apt-get upgrade'

## Ansible
alias ad='ansible-doc '
alias am='ansible-doc -s '
alias avc='ansible-vault create '
alias avd='ansible-vault decrypt '
alias ave='ansible-vault edit '
alias avx='ansible-vault encrypt '
alias avr='ansible-vault rekey '
alias ap='time ansible-playbook'
alias a='time ansible'
alias gather='env-hlgy && time ansible-playbook $HOME/ansible/hireology/playbooks/gather-facts.yml -i $HOME/ansible/hireology/all'

## postgres
alias dbcons="psql -e 'SELECT datname,usename,client_addr,waiting,query_start,current_query FROM pg_stat_activity;'"

## Alert stuff
# usage: execute --long-running --command; alert;
alias alert_helper='history|tail -n1|sed -e "s/^\s*[0-9]\+\s*//" -e "s/;\s*alert$//"'
alert_picture='/usr/share/icons/Adwaita/scalable/apps/utilities-terminal-symbolic.svg'
alias alert='notify-send -i "$alert_picture" "FINISHED: $alert_helper"'

## Functions
# summon ansible facts
ansibleSetup() {
    mkdir -p ~/ansible/facts.d/
    ansible $1 -m setup -i $2 > ~/ansible/facts.d/$1.facts
}

# create a SHA256 hash
createPasswordHash() {
    python -c 'from passlib.hash import sha256_crypt; print sha256_crypt.encrypt("$1")'
}

# new hyde post
newPost() {
    vim ~/hyde/_posts/`date +%F`-$1.md
}

# search for processes and keep column headings
processSearch() {
    ps aux | egrep "$1|PID"
}

# ipa hbactest
ipahbactest() {
    ipa hbactest --user=$1 --host=$2 --service=sshd
}

## ssh stuff
agent() {
    eval $(ssh-agent) > /dev/null 2>&1
    ssh-add ~/.ssh/id_hireology ~/.ssh/WITSkeypair1.pem ~/.ssh/id_ansible > /dev/null 2>&1
}

## Ansible deploys
ansibleQADeploy() {
    time ansible-playbook ~/ansible/hireology/playbooks/deploy-qa.yml -i all -e "hosts=$2 release_branch=$1"
}

## VMware snapshot management
vmwareReset() {
    vmrun -T ws stop ~/vmware/$1/$1.vmx
    last=`vmrun -T ws listSnapshots ~/vmware/$1/$1.vmx | tail -n 1`
    vmrun -T ws revertToSnapshot ~/vmware/$1/$1.vmx ""$last""
    vmrun -T ws start ~/vmware/$1/$1.vmx
}

## Git checkouts
gitCheckout() {
    git checkout $1
    git pull origin $1
}

## Aliases to functions
alias psgrep=processSearch
alias mkpass=createPasswordHash
alias newpost=newPost
alias accio=ansibleSetup
alias hbt=ipahbactest
alias agnt=agent
alias qa-deploy=ansibleQADeploy
alias vmreset=vmwareReset

## Git
alias gco='git checkout'
alias gst='git status'

## Clipboard
alias copy='xclip -selection clipboard'

## Random
# sync music to Sansa Clip Zip
alias musync='rsync -az --no-perms --delete --delete-excluded --exclude=".tor*" --exclude="_tor*" /vault/music/ /media/${USER}/0123-4567/MUSIC'
alias sub='subliminal -l en --providers addic7ed opensubtitles tvsubtitles thesubdb -- '
alias rdesktop='rdesktop -g 1400x900'
alias prettyjson='python -m json.tool'
